@model HomeViewModel
@{
    ViewData["Title"] = "Category";
    Layout = "~/Areas/User/Views/Shared/_Layout.cshtml";
}

<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .product-name, 
        .product-description {
            white-space: nowrap; /* Tek satırda kalmasını sağlar */
            overflow: hidden; /* Taşan içeriği gizler */
            text-overflow: ellipsis; /* Kesilen yere '...' ekler */
            width: 100%; /* Genişliği ayarla (gerekirse değiştir) */
        }
    </style>

    <script>
        let page = 1;
        let isLoading = false;
        let pageSize = 10; // Her sayfada kaç ürün gösterilecek

        function loadMoreProducts(categoryId) {
            if (isLoading) return;
            isLoading = true;
            $("#loading").show();

            $.get(`/User/Home/GetPagedProductsByCategory?page=${page}&pageSize=${pageSize}&categoryId=${categoryId}`, function (data) {
                if (data.length > 0) {
                    data.forEach(product => {
                        $("#product-list").append(`

                    <div class="swiper-slide bg-white shadow-md relative w-full lg:w-60">
                        <a href="User/Home/ProductDetail/${product.id}">

                            <!-- Ürün Resmi -->
                                    <img src="${product.mainImageUrl}" alt="Ürün" class="w-full h-60 md:h-72 object-cover">

                            <div class="pb-3 px-3">
                                <!-- Ürün Bilgileri -->
                                        <h2 class="product-name text-lg font-semibold mt-3">${product.name}</h2>
                                        <p class="product-description text-gray-500 text-sm">${product.description}</p>

                                <div id="price-color-group" class="flex items-center justify-between">
                                    <!-- Fiyat -->
                                            <p class="text-black font-bold mt-2">₺${product.price}</p>

                                    <!-- Renk Seçenekleri -->
                                    <div class="relative flex justify-start items-center mt-2">
                                        <div id="colorContainer" class="relative flex items-center">
                                            <div class="w-5 h-5 rounded-full border-2 border-white bg-[#8B5E3B]"></div>
                                            <div class="w-5 h-5 rounded-full border-2 border-white bg-[#000000] -ml-2.5"></div>
                                            <div class="w-5 h-5 rounded-full border-2 border-white bg-[#FF0000] -ml-2.5"></div>
                                            <div class="w-5 h-5 rounded-full border-2 border-white bg-gray-300 text-xs flex items-center justify-center font-bold -ml-2.5">
                                                +2
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sepete Ekle Butonu -->
                                <button class="mt-4 w-full border-2 border-gray-600 text-black py-2 rounded hover:bg-zinc-100 transition duration-200 ease-in-out">
                                    <i class="fa-solid fa-cart-shopping mr-2"></i> Sepete Ekle
                                </button>
                            </div>
                        </a>
                    </div>
                                    `);
                    });

                    page++; // Sonraki sayfaya geç
                } else {
                    $(window).off("scroll"); // Ürün yoksa scroll olayını kaldır
                }

                $("#loading").hide();
                isLoading = false;
            });
        }

        $(window).scroll(function () {
            if ($(window).scrollTop() + $(window).height() >= $(document).height() - 800) {
                loadMoreProducts(@Model.CurrentCategory);
            }
        });

        // Sayfa açıldığında ilk sayfayı yükle
        $(document).ready(function () {
            loadMoreProducts(@Model.CurrentCategory);
        });
    </script>
</head>

@foreach(var category in Model.Categories)
{
    if(category.CategoryId == Model.CurrentCategory)
    {
        <div class="flex justify-center items-center">
            <div class="border-b-2 border-gray-300 p-2 w-1/2">
                <h1 class="text-2xl font-semibold text-center mt-10">@category.Name</h1>

            </div>
        </div>
    }
}

<section class="pb-16 md:px-3 w-full">
    <div id="product-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 px-2 py-10">
        <!-- Ürünler Listesi -->
        @* @foreach (var product in Model.Products)
        {
            <div class="swiper-slide bg-white shadow-md relative w-60">
                <!-- Ürün Resmi -->
                <img src="@product.ProductImages.FirstOrDefault(img => img.IsMain == true)?.Url.Replace("wwwroot","")" alt="Ürün" class="w-full h-60 md:h-72 object-cover">

                <div class="pb-3 px-3">
                    <!-- Ürün Bilgileri -->
                    <h2 class="product-name text-lg font-semibold mt-3">@product.Name</h2>
                    <p class="product-description text-gray-500 text-sm">@product.Description</p>

                    <div id="price-color-group" class="flex items-center justify-between">
                        <!-- Fiyat -->
                        <p class="text-black font-bold mt-2">₺@product.Price</p>

                        <!-- Renk Seçenekleri -->
                        <div class="relative flex justify-start items-center mt-2">
                            <div id="colorContainer" class="relative flex items-center">
                                <div class="w-5 h-5 rounded-full border-2 border-white bg-[#8B5E3B]"></div>
                                <div class="w-5 h-5 rounded-full border-2 border-white bg-[#000000] -ml-2.5"></div>
                                <div class="w-5 h-5 rounded-full border-2 border-white bg-[#FF0000] -ml-2.5"></div>
                                <div class="w-5 h-5 rounded-full border-2 border-white bg-gray-300 text-xs flex items-center justify-center font-bold -ml-2.5">
                                    +2
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sepete Ekle Butonu -->
                    <button class="mt-4 w-full border-2 border-gray-600 text-black py-2 rounded hover:bg-zinc-100 transition duration-200 ease-in-out">
                        <i class="fa-solid fa-cart-shopping mr-2"></i> Sepete Ekle
                    </button>
                </div>
            </div>
        }
    </div> *@
</section>


<script src="~/js/home.js" defer></script>
