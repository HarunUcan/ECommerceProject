@model ProductDetailViewModel
@{
    ViewData["Title"] = "ProductDetail";
    Layout = "~/Areas/User/Views/Shared/_Layout.cshtml";
}

<head>
    <!-- Swiper JS ve CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .swiper-button-next:after, .swiper-button-prev:after {
            font-size: 24px; /* İkonların boyutunu ayarlamak için */
            font-weight: 900; /* İkonların kalınlığını ayarlamak için */
            color:black; /* İkon rengini ayarlamak için */
        }

        /* Chrome, Safari, Edge, Opera */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }

        input[readonly] {
            background-color: transparent;
            cursor: default;
        }
    </style>
</head>

<!-- Ürün Detay Bölümü -->
<div class="mx-2 bg-white p-6 rounded-lg shadow-lg mt-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Ürün Resmi -->
        <div>
            <!-- Büyük Görsel Swiper -->
            <div class="swiper main-image-swiper w-full xl:w-5/6 rounded-xl mb-4">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <img src="@Model.ProductDto.MainImageUrl" alt="Ürün Resmi" class="w-full h-auto object-contain rounded-xl" />
                    </div>
                    @foreach (var imageUrl in Model.ProductDto.OtherImageUrls)
                    {
                        <div class="swiper-slide">
                            <img src="@imageUrl" alt="Ürün Resmi" class="w-full h-auto object-contain rounded-xl" />
                        </div>
                    }
                </div>
                <!-- Büyük slider navigasyon -->
                <div class="swiper-button-next main-image-next"></div>
                <div class="swiper-button-prev main-image-prev"></div>
            </div>

            <!-- Diğer Görseller Swiper Slider -->
            <div class="swiper w-full xl:w-5/6 my-4">
                <div class="swiper-wrapper">
                    @{
                        var imageIndex = 0;
                    }

                    @if (Model.ProductDto.OtherImageUrls != null && Model.ProductDto.OtherImageUrls.Any())
                    {
                        <div class="swiper-slide">
                            <img src="@Model.ProductDto.MainImageUrl"
                                 alt="Ürün Görseli"
                                 class="w-24 h-24 rounded-lg object-cover cursor-pointer"
                                 onclick="goToSlide(@imageIndex)">
                        </div>
                        imageIndex++;
                    }

                    @foreach (var imageUrl in Model.ProductDto.OtherImageUrls)
                    {
                        <div class="swiper-slide">
                            <img src="@imageUrl"
                                 alt="Ürün Görseli"
                                 class="w-24 h-24 rounded-lg object-cover cursor-pointer"
                                 onclick="goToSlide(@imageIndex)">
                        </div>
                        imageIndex++;
                    }
                </div>
                <!-- Küçük slider navigasyon -->
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>
        </div>


        <!-- Ürün Bilgileri -->
        <div>
            <h1 class="text-4xl font-semibold mb-2">@Model.ProductDto.Name</h1>
            <p class="text-gray-600 mb-4">@Model.ProductDto.Description</p>
            @* <div class="text-3xl font-bold text-gray-900 mb-4">₺@Model.ProductDto.Price</div> *@
            <div class="font-bold text-gray-900 mb-4">
                @if (Model.ProductDto.DiscountedPrice != Model.ProductDto.Price)
                {
                    <div class="line-through text-gray-500 text-red-600">₺@Model.ProductDto.Price.ToString("F2")</div>
                    <div class="text-3xl">₺@Model.ProductDto.DiscountedPrice.ToString("F2")</div>
                }
                else
                {
                    <div class="text-3xl">₺@Model.ProductDto.Price.ToString("F2")</div>
                }
            </div>

            <form asp-controller="Cart" asp-action="AddToCart" method="post">
                <input type="hidden" name="productId" value="@Model.ProductDto.Id"/>
                <!-- Beden Seçimi -->
                <label class="block mb-2 text-gray-700 font-medium">Beden Seçimi</label>
                <div class="flex flex-wrap gap-2 mb-4">
                    @foreach (var size in new[] { "STD", "XXS", "XS", "S", "M", "L", "XL", "XXL" })
                    {
                        bool isContains = Model.ProductDto.ProductVariants.Any(p => p.Size == size);
                        bool isDisabled = true;

                        if (isContains)
                        {
                            var stock = Model.ProductDto.ProductVariants.FirstOrDefault(p => p.Size == size).Stock;
                            isDisabled = !(stock > 0);
                        }
                        else continue;

                        <label class="flex items-center relative cursor-pointer" title="@(isDisabled ? "Stokta Yok" : "")">
                            <input type="radio" name="size" value="@size" class="hidden" onclick="selectSize(this)" @(isDisabled ? "disabled" : "") required>
                            <span class="px-5 py-2 border-2 border-gray-800 rounded-lg transition-colors @(isDisabled ? "bg-gray-300 text-gray-500 cursor-not-allowed relative" : "hover:bg-gray-100")">
                                @size
                                @if (isDisabled)
                                {
                                    <span class="absolute top-0 right-0 -mt-2 -mr-2 w-5 h-5 bg-white border border-black text-red-600 flex items-center justify-center rounded-full font-bold text-xs">
                                        ✕
                                    </span>
                                }
                            </span>
                        </label>
                    }
                </div>

                <!-- Adet Seçimi -->
                <label class="block mb-2 text-gray-700 font-medium">Adet Seçimi</label>
                <div id="quantity-container" class="flex items-center border-2 border-gray-800 p-2 rounded-lg w-28">
                    <button type="button" id="decrease" class="w-7 h-7 bg-white text-lg rounded-full xl:transition xl:hover:bg-gray-300">-</button>
                    <input type="text" id="quantity" name="quantity" class="w-10 text-center text-lg outline-none pointer-events-none" value="1" readonly>
                    <button type="button" id="increase" class="w-7 h-7 bg-white text-lg rounded-full xl:transition xl:hover:bg-gray-300">+</button>
                </div>

                <!-- Stok Adedi -->
                <div class="text-sm text-gray-600 mt-2">Stok Adedi: 20</div>

                <!-- Sepete Ekle Butonu -->
                <button type="button" onclick="validateSelection()" class="w-full py-3 mt-4 bg-black text-white rounded-lg text-lg font-semibold transition hover:bg-gray-700">
                    <i class="fa-solid fa-bag-shopping mr-2"></i> Sepete Ekle
                </button>

                <!-- Grup Ürünleri -->
                @if (Model.ProductDto.GroupProducts != null && Model.ProductDto.GroupProducts.Any())
                {
                    <div class="mt-6">
                        <h2 class="text-lg font-semibold mb-2">Renk Seçenekleri</h2>
                        <div class="flex flex-wrap gap-4 overflow-x-auto">
                            @foreach (var groupProduct in Model.ProductDto.GroupProducts)
                            {
                                <a asp-controller="Home" asp-action="ProductDetail" asp-route-slug="@groupProduct.Slug" class="flex flex-col items-center w-12 md:w-16 text-center">
                                    <img src="@groupProduct.ImageUrl" alt="@groupProduct.Name" title="@groupProduct.Name" class="w-full h-12 md:h-16 rounded-lg object-cover shadow">
                                </a>
                            }
                        </div>
                    </div>
                }
            </form>

            <!-- Ürün Özellikleri -->
            <div class="mt-8">
                <h2 class="text-2xl font-semibold mb-4">Ürün Özellikleri</h2>
                <ul class="list-disc pl-6 text-gray-600">
                    <li>Malzeme: %100 Pamuk</li>
                    <li>Renk: Beyaz</li>
                    <li>Boyut: STD, 2XS, XS, S, M, L, XL, 2XL</li>
                    <li>Yıkama Talimatları: 30°C’de yıkanabilir.</li>
                </ul>
            </div>
        </div>
    </div>

</div>




<script>
    function selectSize(element) {
        document.querySelectorAll('input[name="size"] + span').forEach(span => {
            span.classList.remove('bg-black', 'text-white', 'hover:bg-gray-100');
            span.classList.add('border-gray-800', 'text-black');
        });
        if (!element.disabled) {
            element.nextElementSibling.classList.add('bg-black', 'text-white');
            element.nextElementSibling.classList.remove('border-gray-800', 'text-black');
        }
    }

    function validateSelection() {
        let selectedSize = document.querySelector('input[name="size"]:checked'); // Seçili beden var mı kontrol et

        if (!selectedSize) {
            Swal.fire({
                icon: 'warning',
                title: 'Beden Seçimi Yapmadınız!',
                text: 'Bir beden seçmeden sepete ekleme işlemi yapamazsınız.',
                confirmButtonText: 'Tamam'
            });
        } else {
            // Formu gönder
            document.querySelector('form').submit();
        }
    }

    // Büyük resimler için swiper
    var mainImageSwiper = new Swiper('.main-image-swiper', {
        navigation: {
            nextEl: '.main-image-next',
            prevEl: '.main-image-prev',
        },
        loop: true,
    });

    // Küçük resme tıklayınca büyük swiper'ı güncelle
    function goToSlide(index) {
        mainImageSwiper.slideToLoop(index);
    }

    // Küçük resimler için mevcut Swiper (senin eski kodun zaten burada çalışıyor)
    var swiper = new Swiper('.swiper:not(.main-image-swiper)', {
        slidesPerView: 4,
        spaceBetween: 5,
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        breakpoints: {
            640: {
                slidesPerView: 2,
                spaceBetween: 10,
            },
            768: {
                slidesPerView: 3,
                spaceBetween: 15,
            },
            1024: {
                slidesPerView: 4,
                spaceBetween: 20,
            },
            1200: {
                slidesPerView: 5,
                spaceBetween: 25,
            }
        }
    });

    document.addEventListener("DOMContentLoaded", function () {
        const decreaseBtn = document.getElementById("decrease");
        const increaseBtn = document.getElementById("increase");
        const quantityInput = document.getElementById("quantity");

        decreaseBtn.addEventListener("click", () => {
            let current = parseInt(quantityInput.value);
            if (current > 1) {
                quantityInput.value = current - 1;
            }
        });

        increaseBtn.addEventListener("click", () => {
            let current = parseInt(quantityInput.value);
            quantityInput.value = current + 1;
        });
    });
</script>