@model List<CouponDto>
@{
    ViewData["Title"] = "Index";
    ViewData["ActivePage"] = "Coupons";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-semibold text-gray-700 mb-8">Mevcut Kuponlar</h1>

    <!-- Coupon List -->
    <div class="bg-gray-50 p-8 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold text-gray-700 mb-6">Mevcut Kuponlar</h2>

        <table class="w-full table-auto border-collapse">
            <thead>
                <tr>
                    <th class="border-b-2 py-4 text-left text-gray-600">Kod</th>
                    <th class="border-b-2 py-4 text-left text-gray-600">İndirim</th>
                    <th class="border-b-2 py-4 text-left text-gray-600">Kalan Adet</th>
                    <th class="border-b-2 py-4 text-left text-gray-600">Min. Sipariş(TL)</th>
                    <th class="border-b-2 py-4 text-left text-gray-600">Son Geçerlilik Tarihi</th>
                    <th class="border-b-2 py-4 text-left text-gray-600">Durum</th>
                    <th class="border-b-2 py-4 text-left text-gray-600">İşlemler</th>
                </tr>
            </thead>
            <tbody>

                @foreach(var coupon in Model)
                {
                    <tr>
                        <td class="border-b py-4">@coupon.Code</td>
                        <td class="border-b py-4">
                            @coupon.Discount @(coupon.CouponType == "percentage" ? "%" : "TL")
                        </td>

                        <td class="border-b py-4">@coupon.RemainingUsageCount</td>
                        <td class="border-b py-4">@coupon.MinOrderAmount</td>
                        <td class="border-b py-4">@coupon.ExpirationDate.ToString("dd-MM-yyyy")</td>
                        <td class="border-b py-4">
                            @if (coupon.IsActive == true)
                            {
                                <div class="flex items-center">
                                    <span class="bg-green-500 text-white px-2 font-semibold text-sm rounded-xl">Aktif</span>
                                    <a asp-area="Admin" asp-controller="Coupon" asp-action="ChangeStatus" asp-route-id="@coupon.Id" title="Değiştir">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                                        </svg>
                                    </a>
                                </div>

                            }
                            else
                            {
                                <div class="flex items-center">
                                    <span class="bg-red-500 text-white px-2 font-semibold text-sm rounded-xl">Pasif</span>
                                    <a asp-area="Admin" asp-controller="Coupon" asp-action="ChangeStatus" asp-route-id="@coupon.Id" title="Değiştir">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                                        </svg>
                                    </a>
                                </div>

                            }
                        </td>
                        <td class="border-b py-4">
                            <a href="/kupon-duzenle/${product.id}"
                               class="text-yellow-600 hover:text-yellow-800 transition"><i class="fas fa-edit" title="Düzenle"></i></a>
                            <button onclick="confirmDelete(@coupon.Id)" class="text-red-600 hover:text-red-800 transition" title="Sil"><i class="fa-solid fa-trash-can"></i></button>
                        </td>
                    </tr>
                }
                
            </tbody>
        </table>
    </div>

</div>

<script>
    function confirmDelete(couponId) {
        Swal.fire({
            title: "Emin misiniz?",
            text: "Bu kuponu silmek istediğinize emin misiniz? Bu işlem geri alınamaz!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#d33",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Evet, sil!",
            cancelButtonText: "İptal"
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = `/Admin/Coupon/Delete?id=${couponId}`;
            }
        });
    }
</script>


